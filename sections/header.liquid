{% schema %}
{
  "name": "Header",
  "settings": [
    {
      "type": "image_picker",
      "id": "logo",
      "label": "Logo"
    },
    {
      "type": "range",
      "id": "logo_width",
      "min": 50,
      "max": 300,
      "step": 10,
      "default": 200,
      "unit": "px",
      "label": "Custom Logo Width"
    },
    {
      "type": "link_list",
      "id": "menu",
      "default": "main-menu",
      "label": "Main Menu"
    },
    {
      "type": "color",
      "id": "header_bg_color",
      "label": "Header Background Color",
      "default": "#ffffff"
    },
    {
      "type": "text",
      "id": "phone_number",
      "label": "Phone Number",
      "default": "1-855-783-9597"
    }
  ],
  "blocks": [
    {
      "type": "mega_menu",
      "name": "Mega Menu Section",
      "settings": [
        {
          "type": "text",
          "id": "trigger_label",
          "label": "Menu Link Title",
          "info": "The exact name of the menu link to attach this mega menu to."
        },
        {
          "type": "link_list",
          "id": "menu_submenu",
          "label": "Side Menu",
          "info": "The Level 2 menu to display on the left side."
        }
      ]
    },
    {
      "type": "sidebar_link",
      "name": "Sidebar Bottom Link",
      "settings": [
        {
          "type": "text",
          "id": "trigger_label",
          "label": "Menu Link Title",
          "info": "The exact name of the menu link to attach this link to."
        },
        {
          "type": "text",
          "id": "title",
          "label": "Link Text",
          "default": "Financing Available"
        },
        {
          "type": "url",
          "id": "url",
          "label": "Link URL"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Header"
    }
  ]
}
{% endschema %}

<style>
  .wipe-enter-active {
    transition: clip-path 0.4s ease-out, -webkit-clip-path 0.4s ease-out;
  }
  .wipe-leave-active {
    transition: clip-path 0.3s ease-in, -webkit-clip-path 0.3s ease-in;
  }
  .wipe-enter-start,
  .wipe-leave-end {
    clip-path: inset(0 100% 0 0);
    -webkit-clip-path: inset(0 100% 0 0);
  }
  .wipe-enter-end,
  .wipe-leave-start {
    clip-path: inset(0 0 0 0);
    -webkit-clip-path: inset(0 0 0 0);
  }
</style>

<header 
  class="relative w-full z-40 bg-white shadow-sm"
  x-data="{ 
     openMenu: null,
     activeAccordion: null,
     activePanel: null,
     panelVisible: false,
     toggleMenu(index) {
        if (this.openMenu === index) {
            this.openMenu = null;
        } else {
            this.openMenu = index;
            this.activeAccordion = null; 
            this.activePanel = null;
            this.panelVisible = false;
        }
     },
     closeMenu() {
        this.openMenu = null;
     }
  }"
  @click.outside="closeMenu()"
  @keydown.escape.window="closeMenu()"
>
  
  <!-- Row 1: Logo, Search, Contact -->
  <div class="container mx-auto px-4 md:px-8 py-4 flex flex-col lg:flex-row items-center justify-between gap-8">
    
    <!-- Logo -->
    <a href="{{ routes.root_url }}" class="shrink-0 block">
      {% if section.settings.logo %}
        {{ section.settings.logo | image_url: width: section.settings.logo_width | image_tag: class: 'object-contain', loading: 'eager', height: 'auto' }}
      {% else %}
        <!-- Text Logo Fallback resembling the image's layout if possible, but mainly relying on text -->
        <div class="flex items-center gap-1">
            <span class="text-3xl font-bold tracking-widest text-[#1a2e3b]">HEAT</span>
            <div class="w-8 h-8 rounded-full bg-gradient-to-b from-red-500 to-blue-500 flex items-center justify-center text-white font-serif italic text-lg">&</div>
            <span class="text-3xl font-bold tracking-widest text-[#1a2e3b]">COOL</span>
        </div>
      {% endif %}
    </a>

    <!-- Search Bar -->
    <div class="flex-grow max-w-[600px] w-full mx-auto">
       <form action="{{ routes.search_url }}" method="get" class="flex w-full border border-gray-300 rounded overflow-hidden h-11">
          <input 
            type="search" 
            name="q" 
            placeholder="Search" 
            class="grow px-4 outline-none text-gray-700 placeholder-gray-400 text-sm">
          <button type="submit" class="bg-[#d94426] hover:bg-[#c0351a] text-white px-8 h-full flex items-center gap-2 font-bold transition-colors text-sm uppercase tracking-wide">
             <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
             </svg>
             Search
          </button>
       </form>
    </div>

    <!-- Right Contact Info: Simplified to match reference (Horizontal Layout) -->
    <div class="flex items-center gap-6 text-[#1a2e3b] text-[15px] font-medium">
       <a href="/pages/contact" class="hidden xl:flex items-center gap-3 hover:text-[#d94426] transition-colors">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7 text-[#1a2e3b]" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
            </svg>
            <span>Contact us</span>
            <div class="h-5 w-px bg-gray-300 mx-1"></div>
       </a>
       
       <a href="tel:{{ section.settings.phone_number }}" class="flex items-center gap-3 hover:text-[#d94426] transition-colors">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7 text-[#1a2e3b]" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
            </svg>
            <span class="font-bold">{{ section.settings.phone_number }}</span>
       </a>
    </div>
  </div>

  <!-- Row 2: Navigation -->
  <div class="border-t border-gray-100 border-b border-gray-200 bg-white">
     <div class="container mx-auto px-4 md:px-8 h-14 flex items-center justify-between">
        
        <!-- Left Nav -->
        <nav class="hidden lg:flex gap-8 h-full items-center">
           {% for link in section.settings.menu.links %}
              
              {% assign has_mega_menu = false %}
              {% for block in section.blocks %}
                 {% if block.settings.trigger_label == link.title %}
                 {% assign has_mega_menu = true %}
                 {% break %}
                 {% endif %}
              {% endfor %}

              <div class="h-full flex items-center">
                 <a 
                 href="{{ link.url }}" 
                 class="group flex items-center gap-1 text-base font-bold uppercase tracking-wider text-[#d94426] transition-all h-full relative border-b-4 border-transparent hover:border-[#d94426]"
                 :class="{ '!border-[#d94426]': openMenu === '{{ link.title | handleize }}' }"
                 @click.prevent="toggleMenu('{{ link.title | handleize }}')"
                 >
                 <span class="whitespace-nowrap">{{ link.title }}</span>
                 {% if has_mega_menu or link.links.size > 0 %}
                    <!-- Chevron Down -->
                    <span 
                       class="block h-3 w-3 shrink-0 transition-transform duration-200 text-[#d94426] [&>svg]:w-full [&>svg]:h-full [&>svg]:fill-current"
                       :class="{ 'rotate-180': openMenu === '{{ link.title | handleize }}' }"
                    >
                       {% render 'chevron-icon' %}
                    </span>
                 {% endif %}
                 </a>

                 <!-- Mega Menu Dropdown -->
                 {% if has_mega_menu %}
                    <div 
                       class="absolute left-0 top-full -mt-px w-full bg-black/60 shadow-xl transform origin-top z-50 transition-opacity duration-300"
                       x-show="openMenu === '{{ link.title | handleize }}'"
                       x-transition:enter="transition ease-out duration-200"
                       x-transition:enter-start="opacity-0"
                       x-transition:enter-end="opacity-100"
                       @mouseleave="panelVisible = false"
                    >
                       <div class="container mx-auto px-4 md:px-8 flex h-[600px]">
                          <!-- Sidebar (Fixed 25% width) -->
                          <div 
                             class="w-1/4 shrink-0 py-6 bg-[#F8F8F8] border-r border-[#C6C9CD] flex flex-col gap-1 overflow-y-auto z-20 shadow-lg [&::-webkit-scrollbar]:hidden" 
                             style="scrollbar-width: none; -ms-overflow-style: none;"
                             @mouseover.self="panelVisible = false; activePanel = null"
                          >
                             {% for block in section.blocks %}
                                {% if block.settings.trigger_label == link.title %}
                                   
                                   {% if block.type == 'mega_menu' %}
                                      {% assign side_menu = block.settings.menu_submenu %}
                                      <div class="sidebar-accordion-item border-b border-gray-100 last:border-0">
                                         <button 
                                            class="w-full text-left px-5 py-4 flex items-center justify-between font-semibold text-black hover:text-[#d94426] transition-colors uppercase text-base"
                                            @click="activeAccordion = (activeAccordion === '{{ block.id }}' ? null : '{{ block.id }}'); activePanel = null; panelVisible = false;"
                                            @mouseenter="panelVisible = false; activePanel = null"
                                            :class="activeAccordion === '{{ block.id }}' ? 'text-[#d94426]' : ''"
                                         >
                                            {{ side_menu.title | default: block.settings.trigger_label }}
                                            <svg 
                                               class="w-2.5 h-2.5 transition-transform duration-300 transform text-gray-400"
                                               :class="activeAccordion === '{{ block.id }}' ? 'rotate-90 text-[#d94426]' : ''"
                                               xmlns="http://www.w3.org/2000/svg" viewBox="0 0 6 10"
                                            >
                                               <path d="M1.32562,0.04631v0l-1.3258,1.41233v0l3.34797,3.56428v0l-3.34797,3.56496v0l1.3258,1.41131v0l4.67411,-4.97627v0z" fill="currentColor"></path>
                                            </svg>
                                         </button>
                                         
                                         <div x-show="activeAccordion === '{{ block.id }}'" x-collapse>
                                            <div class="bg-white pb-2">
                                               {% if side_menu.links.size > 0 %}
                                                  {% for child_link in side_menu.links %}
                                                     <div class="relative">
                                                        <a href="{{ child_link.url }}" 
                                                           class="flex items-center justify-between px-5 py-2 text-gray-600 hover:text-[#d94426] transition-all text-[13px]"
                                                           @mouseenter="activePanel = '{{ child_link.title | handleize }}-{{ block.id }}'; panelVisible = true;"
                                                        >
                                                           <span class="relative pl-3">
                                                              {{ child_link.title }}
                                                              <span 
                                                                 class="absolute left-0 top-1/2 -translate-y-1/2 w-1.5 h-1.5 bg-[#d94426] rounded-full transition-opacity"
                                                                 :class="activePanel === '{{ child_link.title | handleize }}-{{ block.id }}' ? 'opacity-100' : 'opacity-0'"
                                                              ></span>
                                                           </span>
                                                           {% if child_link.links.size > 0 %}
                                                              <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 transition-opacity text-gray-400" :class="activePanel === '{{ child_link.title | handleize }}-{{ block.id }}' ? 'opacity-100 text-[#d94426]' : 'opacity-50'" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                                 <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                                                              </svg>
                                                           {% endif %}
                                                        </a>
                                                     </div>
                                                  {% endfor %}
                                               {% endif %}
                                            </div>
                                         </div>
                                      </div>
                                   
                                   {% elsif block.type == 'sidebar_link' %}
                                      <div class="sidebar-link-item border-b border-gray-100 last:border-0 hover:bg-gray-50 transition-colors">
                                         <a 
                                            href="{{ block.settings.url }}" 
                                            class="w-full block px-5 py-4 font-bold text-[#d94426] uppercase text-base"
                                            @mouseenter="panelVisible = false; activePanel = null"
                                         >
                                            {{ block.settings.title }}
                                         </a>
                                      </div>
                                   {% endif %}

                                {% endif %}
                             {% endfor %}
                          </div>

                          <!-- Right Panel (Transparent overlay, slides in white content) -->
                          <div class="w-3/4 relative h-full pointer-events-none">
                             <!-- Active panel content -->
                             <div
                                x-show="panelVisible"
                                x-transition:enter="wipe-enter-active"
                                x-transition:enter-start="wipe-enter-start"
                                x-transition:enter-end="wipe-enter-end"
                                x-transition:leave="wipe-leave-active"
                                x-transition:leave-start="wipe-leave-start"
                                x-transition:leave-end="wipe-leave-end"
                                class="absolute inset-0 bg-white pointer-events-auto z-20"
                                style="display: none;"
                             >
                                {% for block in section.blocks %}
                                   {% if block.settings.trigger_label == link.title and block.type == 'mega_menu' %}
                                      {% assign side_menu = block.settings.menu_submenu %}
                                      {% for child_link in side_menu.links %}
                                         {% if child_link.links.size > 0 %}
                                            <div class="absolute inset-0 bg-white p-8 grid grid-cols-5 gap-6 overflow-y-auto [&::-webkit-scrollbar]:hidden" style="scrollbar-width: none; -ms-overflow-style: none;"
                                                 x-show="activePanel === '{{ child_link.title | handleize }}-{{ block.id }}'"
                                                 style="display: none;"
                                            >
                                               {% for grandchild_link in child_link.links %}
                                                  {% assign collection_handle = grandchild_link.url | split: '/collections/' | last | split: '/' | first %}
                                                  {% assign collection = collections[collection_handle] %}
                                                  <a href="{{ grandchild_link.url }}" class="group/card flex flex-col gap-2 p-2 rounded transition-colors">
                                                     <div class="aspect-4/3 rounded-lg overflow-hidden relative">
                                                        {% if collection.image %}
                                                          {{ collection.image | image_url: width: 300 | image_tag: class: 'w-full h-full object-contain', loading: 'lazy' }}
                                                        {% else %}
                                                          <div class="w-full h-full bg-gray-200 group-hover/card:bg-gray-300 transition-colors flex items-center justify-center text-gray-400">
                                                             <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                                                             </svg>
                                                          </div>
                                                        {% endif %}
                                                     </div>
                                                     <span class="text-sm font-semibold text-[#00bcd4] group-hover/card:text-[#d94426] transition-colors text-center">{{ grandchild_link.title }}</span>
                                                  </a>
                                               {% endfor %}
                                            </div>
                                         {% endif %}
                                      {% endfor %}
                                   {% endif %}
                                {% endfor %}
                             </div>
                          </div>
                       </div>
                    </div>
                 {% endif %}
              </div>
           {% endfor %}
        </nav>

        <!-- Right Side Links -->
        <div class="flex items-center gap-6 text-[#1a2e3b] text-xs font-bold uppercase tracking-wide">
           <a href="/pages/quote" class="flex items-center gap-2 hover:text-[#d94426]">
              <span class="text-[#d94426] border border-[#d94426] w-5 h-5 rounded flex items-center justify-center text-[10px]">[o]</span>
              <span>Quote-By-Photo</span>
           </a>
           <div class="h-4 w-px bg-gray-200"></div>
           <a href="/pages/about-us" class="hover:text-[#d94426]">About Us</a>
        </div>
        
     </div>
  </div>

  <!-- Mobile Menu Button (Hamburger) - Basic functionality placeholder -->
  <div class="lg:hidden p-4 border-b flex justify-between items-center">
     <span class="font-bold">Menu</span>
     <button class="text-gray-600" aria-label="Menu" onclick="document.querySelector('#mobile-menu-drawer').classList.remove('translate-x-full')">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
           <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
        </svg>
     </button>
  </div>

  <div id="mobile-menu-drawer" class="fixed inset-0 z-50 bg-white transform translate-x-full transition-transform duration-300 lg:hidden overflow-y-auto">
     <!-- Mobile Drawer Content -->
  </div>

</header>
